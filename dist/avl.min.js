(function(){var a,b,c,d,e,f,g;c=0,d=1,e=function(a){return 1-a},f=function(a,b,c){var d;return d=a[c],a[c]=b[c],b[c]=d},a=function(){function a(a,b,c){this._tree=a,this.key=b,this.value=null!=c?c:null,this.parent=null,this._children=[null,null],this._height=1,this._balance=0}return a.prototype.left=function(){return this._children[c]},a.prototype.right=function(){return this._children[d]},a.prototype.height=function(){return this._height},a.prototype.balance=function(){return this._balance},a.prototype.is_root=function(){return null==this.parent},a.prototype.is_leaf=function(){return null==this.left()&&null==this.right()},a.prototype.is_invalid=function(){return null==this._tree},a.prototype._is_balanced=function(){return Math.abs(this._balance)<2},a.prototype._debug_string=function(){var a;return a="",null!=this.left()&&(a+=this.key+" --L--> "+this.left().key+"\n",a+=this.left()._debug_string()),null!=this.right()&&(a+=this.key+" --R--> "+this.right().key+"\n",a+=this.right()._debug_string()),a},a.prototype._invalidate=function(){return this.parent=null,this._children[c]=null,this._children[d]=null,this.key=null,this.value=null,this._tree=null},a.prototype._update=function(){var a,b;return a=null!=this.left()?this.left()._height:0,b=null!=this.right()?this.right()._height:0,this._height=1+Math.max(a,b),this._balance=a-b},a.prototype._swap_parent=function(a){return f(this,a,"parent"),this.parent===this&&(this.parent=a),a.parent===a?a.parent=this:void 0},a.prototype._swap_children=function(a){var b,e,g,h,i;for(f(this,a,"_children"),g=[[this,a],[a,this]],h=[],b=0,e=g.length;e>b;b++)i=g[b],h.push(function(){var a,b,e,f,g,h,j;for(a=i[0],b=i[1],h=[c,d],j=[],f=0,g=h.length;g>f;f++)e=h[f],j.push(function(){var c;return a._children[e]===a?a._children[e]=b:null!=(c=a._children[e])?c.parent=a:void 0}());return j}());return h},a.prototype._swap=function(a){return a!==this?(this._swap_parent(a),this._swap_children(a),f(this,a,"_height"),f(this,a,"_balance")):void 0},a.prototype._index_of=function(a){return this.left()===a?c:this.right()===a?d:null},a.prototype._connect_child=function(a,b){return this._children[b]=a,null!=a&&(a.parent=this),this._update()},a.prototype._rotate_XX=function(a){var b,c,d,f;return d=e(a),b=this,c=b._children[a],f=b.parent,b._connect_child(c._children[d],a),c._connect_child(b,d),null!=f?f._connect_child(c,f._index_of(b)):c.parent=null},a.prototype._rotate_XY=function(a){var b,c,d,f;return f=e(a),b=this,c=b._children[a],d=c._children[f],c._connect_child(d._children[a],f),d._connect_child(c,a),b._connect_child(d,a)},a.prototype.remove=function(){return this.is_invalid()?null:this._tree._remove_node(this)},a}(),b=function(){function b(a){null==a&&(a=function(a,b){return a-b}),this._comparator=a,this.root=null}return b.prototype._restore_balance=function(a){for(a._update();!a.is_root()||!a._is_balanced();)2===a._balance?(-1===a.left()._balance&&a._rotate_XY(c),a._rotate_XX(c)):-2===a._balance&&(1===a.right()._balance&&a._rotate_XY(d),a._rotate_XX(d)),a.is_root()||(a=a.parent,a._update());return this.root=a},b.prototype.is_empty=function(){return null==this.root},b.prototype.search=function(a){var b,c,d;if(this.is_empty())return null;for(c=this.root,d=null;null!=c;){if(d=c,b=this._comparator(d.key,a),0===b)return d;c=b>0?c.left():c.right()}return d},b.prototype.insert=function(b,e){var f,g,h;return null==e&&(e=null),this.is_empty()?this.root=new a(this,b,e):(h=this.search(b),f=this._comparator(h.key,b),0===f?null:(g=new a(this,b,e),h._connect_child(g,f>0?c:d),this._restore_balance(h),g))},b.prototype._remove_node=function(a){var c,d,e,f,g;return null!=a.left()&&null!=a.right()&&(e=new b(this._comparator),e.root=a.left(),g=e.search(a.key),a._swap(g)),a.is_root()?null!=a.left()?(this.root=a.left(),a.left().parent=null):(this.root=a.right(),null!=(d=a.right())&&(d.parent=null)):(c=a.parent._index_of(a),null!=a.left()?a.parent._connect_child(a.left(),c):a.parent._connect_child(a.right(),c),this._restore_balance(a.parent)),f=a.value,a._invalidate(),f},b.prototype.remove=function(a){var b,c;return this.is_empty()?null:(c=this.search(a),b=this._comparator(c.key,a),0!==b?null:this._remove_node(c))},b}(),g=this,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)&&(module.exports=b),g.AVLTree=b}).call(this);